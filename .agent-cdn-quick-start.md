# ğŸš€ R2 CDN ë¹ ë¥¸ ì ìš© ê°€ì´ë“œ (Quick Start for Agents)

ì´ ë¬¸ì„œëŠ” **ë‹¤ë¥¸ Agentê°€ ì‹œí–‰ì°©ì˜¤ ì—†ì´** R2 CDNì„ ì ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  ê°„ì†Œí™”ëœ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“Œ ì‚¬ì „ ì¤€ë¹„ (ì‚¬ìš©ìê°€ ì œê³µí•´ì•¼ í•  ì •ë³´)

Agentì—ê²Œ ë‹¤ìŒ ì •ë³´ë¥¼ ì œê³µë°›ìœ¼ì„¸ìš”:

```
í”„ë¡œì íŠ¸ëª…: [ì˜ˆ: audit, dcf, npl]
ì„œë²„ íƒ€ì…: [NAS / OMV / Debian]
R2_SERVER_PREFIX: [ì˜ˆ: nas2025, omv2025, debian2025]
ì›¹ì‚¬ì´íŠ¸ URL: [ì˜ˆ: https://map.goal-runner.com/portal/]
```

---

## âš¡ ë¹ ë¥¸ ì‹¤í–‰ (3ë‹¨ê³„)

### Step 1: ìë™ ì ìš© ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
python apply_cdn_auto.py
```

ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…:
- âœ… `.env` íŒŒì¼ì—ì„œ R2 ì„¤ì • í™•ì¸
- âœ… `requirements.txt`ì— í•„ìˆ˜ íŒ¨í‚¤ì§€ ì¶”ê°€
- âœ… `settings.py`ì— R2 CDN ì„¤ì • ì¶”ê°€
- âœ… í…œí”Œë¦¿ íŒŒì¼ì— `{% load static %}` ì¶”ê°€
- âœ… `r2_sync_tool.py` ìƒì„± (R2 ì—…ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸)
- âœ… `verify_cdn.py` ìƒì„± (ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸)

### Step 2: R2ì— ì •ì  íŒŒì¼ ì—…ë¡œë“œ

```bash
python r2_sync_tool.py
```

ì˜ˆìƒ ì¶œë ¥:
```
--- Static Files Sync (nas2025) ---
[nas2025] R2 uploading: static/css/map_app.css -> nas2025/static/css/map_app.css
[OK] Upload complete!
[nas2025] R2 uploading: static/js/map_app.js -> nas2025/static/js/map_app.js
[OK] Upload complete!
--- Static Sync Complete (2 files uploaded) ---
```

### Step 3: ì„œë²„ ë°°í¬ ë° ê²€ì¦

#### 3-1. ì„œë²„ ë°°í¬
í”„ë¡œì íŠ¸ì˜ ê¸°ì¡´ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:
```bash
# ì˜ˆì‹œ (í”„ë¡œì íŠ¸ë§ˆë‹¤ ë‹¤ë¦„)
deploy_to_nas.bat
# ë˜ëŠ”
python deploy_to_server.py
```

#### 3-2. CDN ì ìš© í™•ì¸
```bash
python verify_cdn.py
```

ì…ë ¥ í”„ë¡¬í”„íŠ¸ì— ì›¹ì‚¬ì´íŠ¸ URL ì…ë ¥:
```
ê²€ì¦í•  ì›¹ì‚¬ì´íŠ¸ URLì„ ì…ë ¥í•˜ì„¸ìš”: https://map.goal-runner.com/portal/
```

ì„±ê³µ ì‹œ ì¶œë ¥:
```
Status Code: 200

âœ… CDN domain (assets.goal-runner.com) found: True

CSS Files (1):
  - https://assets.goal-runner.com/nas2025/static/css/map_app.css [CDN]

JS Files (2):
  - //dapi.kakao.com/v2/maps/sdk.js?appkey=...
  - https://assets.goal-runner.com/nas2025/static/js/map_app.js [CDN]

================================================================================
Total static files: 3
Using CDN: 2
CDN Status: âœ… ENABLED
```

---

## ğŸ¯ Agent ì‘ì—… ì§€ì‹œ ì˜ˆì‹œ

ì‚¬ìš©ìê°€ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì— CDNì„ ì ìš©í•˜ê³  ì‹¶ì„ ë•Œ ë‹¤ìŒê³¼ ê°™ì´ ì§€ì‹œí•˜ë©´ ë©ë‹ˆë‹¤:

```
".agent-cdn-quick-start.md íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ ì´ í”„ë¡œì íŠ¸ì— R2 CDNì„ ì ìš©í•´ì¤˜.

í˜„ì¬ ì„œë²„ ì •ë³´:
- í”„ë¡œì íŠ¸: audit
- ì„œë²„: OMV (192.168.0.30)
- R2_SERVER_PREFIX: omv2025
- ì›¹ì‚¬ì´íŠ¸ URL: https://audit.goal-runner.com

ê°€ì´ë“œì˜ 3ë‹¨ê³„ë¥¼ ìˆœì„œëŒ€ë¡œ ìˆ˜í–‰í•˜ê³ , ê° ë‹¨ê³„ ì™„ë£Œ í›„ ê²°ê³¼ë¥¼ ë³´ê³ í•´ì¤˜."
```

---

## ğŸ”§ ìˆ˜ë™ ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš°

### .env íŒŒì¼ ì„¤ì •

ë§Œì•½ `.env` íŒŒì¼ì— R2 ì„¤ì •ì´ ì—†ë‹¤ë©´ ë‹¤ìŒì„ ì¶”ê°€í•˜ì„¸ìš”:

```env
# Cloudflare R2 Storage (S3 Compatible)
R2_ACCESS_KEY_ID=your_access_key_here
R2_SECRET_ACCESS_KEY=your_secret_key_here
R2_BUCKET_NAME=map-storage
R2_ACCOUNT_ID=your_account_id_here
R2_ENDPOINT_URL=https://your_account_id.r2.cloudflarestorage.com
R2_SERVER_PREFIX=omv2025  # ì„œë²„ë³„ë¡œ ë³€ê²½
R2_CUSTOM_DOMAIN=https://assets.goal-runner.com
```

**âš ï¸ ì¤‘ìš”**: 
- `R2_SERVER_PREFIX`ëŠ” ì„œë²„ë§ˆë‹¤ ë‹¬ë¼ì•¼ í•©ë‹ˆë‹¤ (nas2025, omv2025, debian2025 ë“±)
- ì‹¤ì œ R2 ìê²©ì¦ëª…ì€ ì‚¬ìš©ìì—ê²Œ ìš”ì²­í•˜ì„¸ìš”

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: "No module named 'storages'" ì—ëŸ¬

**í•´ê²°**:
```bash
pip install django-storages[s3] boto3
```

ê·¸ë¦¬ê³  ì„œë²„ì— ë°°í¬ ì‹œ ì»¨í…Œì´ë„ˆë¥¼ ì¬ë¹Œë“œí•˜ì„¸ìš”.

### ë¬¸ì œ 2: CDNì´ ì ìš©ë˜ì§€ ì•ŠìŒ (verify_cdn.pyì—ì„œ CDN Status: âŒ)

**ì›ì¸**: í…œí”Œë¦¿ íŒŒì¼ì— ì—¬ì „íˆ ì¸ë¼ì¸ CSS/JSê°€ ìˆìŒ

**í•´ê²°**:
1. í…œí”Œë¦¿ íŒŒì¼ í™•ì¸
2. `<style>` íƒœê·¸ ë‚´ìš©ì„ `static/css/` í´ë”ì˜ CSS íŒŒì¼ë¡œ ì´ë™
3. `<script>` íƒœê·¸ ë‚´ìš©ì„ `static/js/` í´ë”ì˜ JS íŒŒì¼ë¡œ ì´ë™
4. í…œí”Œë¦¿ì—ì„œ `{% static %}` íƒœê·¸ë¡œ ì°¸ì¡°

ì˜ˆì‹œ:
```django
{% load static %}
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
</head>
<body>
    <!-- ë‚´ìš© -->
    <script src="{% static 'js/app.js' %}"></script>
</body>
</html>
```

### ë¬¸ì œ 3: 500 ì—ëŸ¬ ë°œìƒ

**í•´ê²°**: ì„œë²„ ë¡œê·¸ í™•ì¸
```bash
# Docker ë¡œê·¸ í™•ì¸
docker logs --tail 50 [í”„ë¡œì íŠ¸ëª…]-backend
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸:
- [ ] `apply_cdn_auto.py` ì‹¤í–‰ ì™„ë£Œ
- [ ] `r2_sync_tool.py` ì‹¤í–‰ ì™„ë£Œ (ì •ì  íŒŒì¼ ì—…ë¡œë“œ)
- [ ] ì„œë²„ ë°°í¬ ì™„ë£Œ
- [ ] `verify_cdn.py`ë¡œ CDN ì ìš© í™•ì¸ ì™„ë£Œ
- [ ] ë¸Œë¼ìš°ì €ì—ì„œ ì›¹ì‚¬ì´íŠ¸ ì •ìƒ ì‘ë™ í™•ì¸

---

## ğŸ“š ìƒì„¸ ê°€ì´ë“œ

ë” ìì„¸í•œ ë‚´ìš©ì€ `.agent-cdn-setup-guide.md` íŒŒì¼ì„ ì°¸ê³ í•˜ì„¸ìš”.

---

**ì‘ì„±ì¼**: 2026-02-16  
**ê²€ì¦ ì™„ë£Œ**: NAS ì„œë²„ (map.goal-runner.com, nas2025)  
**ë‹¤ìŒ ì ìš© ëŒ€ìƒ**: OMV, Debian ì„œë²„
